const assert = require('chai').assert;
const Stream = require('../src/index.js');

describe('Stream chain', () => {

    it('should chain then clauses', () => {
        let test = false;
        const b = new Stream();
        b.then(data => ++data)
            .then(data => ++data)
            .then(data => {
                assert.equal(data, 4);
                if (data == 4) {
                    test = true;
                }
            });

        b.notify(2);
        assert.equal(test, true);
    });

    it('should chain with map clauses', () => {
        let test = false;
        const obj = [1, 2, 3];
        const b = new Stream();
        b.map(x => x + 1)
            .then(data => {
                for (let i in data) {
                    assert.equal(data[i], obj[i] + 1);
                }
                test = true;
            });

        b.notify(obj);
        assert.equal(test, true);
    });

    it('should only execute each function once', () => {
        let add = 0;
        const b = new Stream();
        b.then(() => ++add)
            .then(() => ++add)
            .then(() => ++add);

        b.notify();
        assert.equal(add, 3);
    });

});